<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Encryptor</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- <link href="bootstrap.min.css" rel="stylesheet"> -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <script type="text/javascript" language="javascript" src="dzicrypto-1.0.2.js"></script>
        <!-- <script type="text/javascript" language="javascript" src="jquery-3.6.0.min.js"></script> -->
      </head>
    <body>
        <div class="container">
            <div class="mt-2">
                <label for="pass">Password</label>
                <input type="password" id="pass" class="form-control" placeholder="" value="" required>
            </div>
            <div class="mt-2">
                <div class="d-flex justify-content-between">
                    <div>
                        <label for="source">Source</label>
                    </div>
                    <div>
                        <button type="button" class="btn btn-light" onclick="pasteSource()">Paste</button>  
                    </div>
                </div>
                <textarea id="source" class="form-control" rows="5"></textarea>
            <div>
            <div class="mt-3">
                <button id="encrypt-button" class="btn btn-primary" onclick="encrypt()">Encrypt</button>
                <button id="decrypt-button" class="btn btn-primary" onclick="decrypt()">Decrypt</button>
            </div>
            <div class="mt-2">
                <div class="d-flex justify-content-between">
                    <div>
                        <label for="result">Result</label>
                    </div>
                    <div>
                        <button type="button" class="btn btn-light" onclick="copyResult()">Copy</button>  
                    </div>
                </div>
                <textarea id="result" class="form-control" rows="5" readonly></textarea>
            </div>
           
        </div>

        <script>

            function exec(res) {
                var lastError = DziCryptoApi.getLastError();
                var code = lastError.getCode();
                if (code === 0) {
                    return res;
                } else {
                    var msg = "DziCryptoApi error " + code + " with message: '" + lastError.getMessage() + "'";
                    console.error(msg);
                    lastError.reset();
                    throw new Error(msg);
                }
            }

            function encrypt() {
                $("#result").html();
                var res = exec(DziCryptoApi.encryptMessage($("#source").val(), $("#pass").val(), 23));
                $("#result").val(res);
            }

            function decrypt() {
                $("#result").html();
                var res = exec(DziCryptoApi.decryptMessage($("#source").val(), $("#pass").val()));
                console.log(res);
                $("#result").val(res);
            }

            function copyResult() {
                navigator.clipboard.writeText($("#result").val());
            }

            function pasteSource() {
                navigator.clipboard.readText().then(msg => $("#source").val(msg));
            }

        </script>
    </body>
</html>